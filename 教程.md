# 对家庭路由器的小威胁：DHCP地址池抢占耗尽

## 前言：

​		“自从有了IPv6，地球上的每个砂砾都可以用IP地址寻址了。”

​		本教程纯属娱乐，请勿当真。本教程只是提供一种小白思路，有种小孩子过家家的感觉，不要拿本文内容做有可能违法的事情。另外如果你是网络小白，千万别拿自家WIFI试。

​		本人是一名在校大学生。某天在阅读 Kurose 和 Ross 合著的《计算机网络：自顶向下方法（第八版）》时，读到关于 IPv4 地址池耗尽、NAT 技术以及 DHCP 服务器的部分时，突然想到，既然 IPv4 地址已经耗尽，目前内网 IP（如：192.168.0.100）就像是对 40 亿个 IPv4 地址已被占用的妥协。于是想出了一个点子，希望能够“干扰”一下你的邻居对 IPv4 的使用，顺便推动 IPv6 的普及，（当然也只是说说，一个人的力量终究是有限的）因为目前大多数家庭路由器的IPv6功能是默认关闭的。这个实验与 DHCP 服务器的角度有关。

​		目前，家庭路由器大多连接到光猫的 LAN 口，光纤入户和光猫通常由当地 ISP 负责安装。路由器再通过 DHCP 服务器为连接到 Wi-Fi 的设备分配内网 IP 地址，而这个过程通常又依靠MAC地址做唯一身份识别码。更多的细节这里就不多说了，我们直接进入正题：如何让不懂路由器配置和用户身份鉴别的邻居，在短时间内对自家路由器感到恼火。

## 步骤1

​		如果你也是一个网络小白，首先你要有邻居的WIFI密码或者一台曾经连接过，目前还可以自动连接的PC设备。完成这一步是个大前提，因为没有接入网络的设备DHCP服务器是不会给你分配IP地址的。

​		如果你是资深专家，那方法可就多了。避免法律问题，这里就不多提了。你甚至可以直接跳过这一步，在后期的内容全部使用先嗅探再制作DHCP欺骗报文和路由器交互就可以了，(这个也会的话可以直接不用看了，你也就瞧不起这种方法了。)当然也有一些支持DHCP欺骗的工具软件，涉及到法律问题这里也就不多说了，要做守法好公民。

## 步骤2

​		准备一台虚拟机。

​		这一步可有可无，个人建议你用虚拟机，这样路由器管理界面看到的就是匿名主机而不是你的PC名字。

​		本次趣味实验配置：Oracle VM VirtualBox,虚拟机系统：win11-v23h2,内存4GB，4vCPU，桥接网卡，

​		虚拟机网卡设置：Intel PRO/1000 MT 桌面 (82540EM)

## 步骤3

​		在网络适配器属性—高级目录下，找到LAA(Locally Administered Address)选项，修改数值为112233445566或者其他你熟悉的12个数字(加字母)格式。这一步因人而异，有的网络适配器可以直接修改MAC地址，如果有的话，操作方法类似。

​		键盘win+R，输入regedit进入注册表编辑器，你可能看到好多个大文件夹在左侧栏，随机找一个按Ctrl+F查找你刚才输入的数值，找不到就换一个大文件夹。

​		如果找到的值的左旁栏是Network Address，恭喜你找对了，你已经完成一大半的步骤了。找不到也别灰心，换个数值重复步骤3，总会找到的。(如果你用和我一样的配置，可以试试直接按我下面的路径找)

​		现在，点击上方地址栏，把地址复制下来。如：“HKLM\SYSTEM\CurrentControlSet\Control\Class\{4D36E972-E325-11CE-BFC1-08002BE10318}\0001”

## 步骤4

​		修改python文件。		

​		修改路径和适配器名称，之后打开Windows搜索栏，输入cmd或者PowerShell，以管理员身份运行，(修改注册表需要权限)转到文件所在路径，运行文件即可。

​		其中的time.sleep()的值可以根据你设备情况进行缩短或者延长，也许你会好奇要多久才能填满，假设5秒一个IPv4地址，那么最多只要20几分钟就满了！(不考虑中途可能有几次没有申请到的情况)这个是因为一般家庭路由器IPv4掩码是255.255.255.0, 最多也就维护256个，其中第一个会被占用，所以根据网络属性中的地址掩码就可以知道需要多长时间。

## 后记

​		再次重申，本项目只是以实验为目的，实验过程使用自家路由器测试！填满DHCPv4地址池后，确实会出现新设备无法分配IPv4地址的情况，如果你的路由器没有打开IPv6功能，那么你的新设备将不能正常上网。另外，如果一直运行代码，DHCP持续被抢占，有可能在原主人的IP地址租期到期时，原主人的IPv4地址也可能被抢走！(前提是没有进行MAC和IP绑定)，那么原主人也会像个新设备一样，无法连入网络。那么现在给他的选项就是：连接网线进入管理界面清空地址池，或者初始化路由器。如果他的路由器开启了IPv6功能，那么新设备还是可以正常接入并上网，因为DHCPv6和DHCPv4是独立的，这也好，至少IPv6普及到了你的邻居。

​		欢迎讨论，仅做学习！
